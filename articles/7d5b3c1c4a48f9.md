---
title: "「パーフェクトRuby on Rails」の「エキスパートRails」の章についてまとめてみた"
emoji: "📌"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["rails", "ruby"]
published: false
---

## 導入

「パーフェクト Ruby on Rails」という書籍を知っていますか？
この書籍は Ruby on Rails の基本情報を紹介しつつより実務を想定した Rails の
環境設定や実際にアプリケーションを作ってみたり、拡張、変更に強いコードや設計について
網羅的に解説しているものです。

Rails は MVC に基づいているフレームワークで特定の要件を実装する際にコードを書く場所についてわかっていないで書いても実装はできてしまいます。

がアプリケーションが大きくなった時に変更や拡張がしずらくなる性質もあります。（どのフレームワークにも共通していることではありますが）

実務で Rails を書いていて要件を実装する際に既存コードを見つつもどこに何を書けば良いか迷う時がありました。

そんな時 書籍の Part5 の「エキスパート Rails」 の章は要件を実装する際のユースケースやドメインロジックをどう書けば変更拡張に強いコードで実装できるのかを体系的に述べていて Rails の設計周りでとても勉強になったので章のまとめとして記事にさせていただきました。

## 前提

これから rails で変更や拡張に強いコードの書き方をするためのいくつかの手法を紹介していくが、どれも共通しているのは Model 層にロジックが溜まって Model 層が肥大化していくのを防ぐために導入している側面があるので、Model に書きがちなロジックを Model から分離するためのテクニックだということを頭に留めながら読み進めていくと理解しやすいかなと思います。

## 値オブジェクト

値オブジェクトとは、住所や血液型など、値が同じでも同一性を判断できない情報のことをいいます。

つまり、同じ住所を持つユーザーオブジェクトが複数あったとしてもどちらも全く同じユーザーを指しているわけではないです。
あくまで住所本体の値としてはそれぞれ同一であるということです。

Rails の場合、ActiveRecord を実装したものなので値オブジェクトに該当する属性は ActiveRecord 上のカラムに存在しています。

余談ですが全ての属性が値オブジェクトになる訳ではなく、ユーザーオブジェクトを識別する属性が例えばマイナンバーや id などの一意にオブジェクトを識別する属性を持っていた場合、一人のユーザーを指していて複数存在することはありません。

マイナンバーなどの一意な属性を持つオブジェクトをエンティティと言います。

試しに住所を表すロジックを Model に書いてみます。

'' ruby
class User < ApplicationRecord

def address
addr = "#{prefecture}#{city}#{district}"
addr << " #{building}" if building.present?

    return "#{postal}: #{addr}" if postal.present?

    addr

end

end
''

### 導入するタイミング

## サービスオブジェクト

### 導入するタイミング

## ユースケースの実装

### フォームオブジェクト

### 共通のバリデーションルールを定義する

## ActiveSupport::Concern を使った実装

### コールバックオブジェクト
